<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #eef1f7; font-family: 'Segoe UI', sans-serif; }
    .sidebar {
      width: 240px; height: 100vh; position: fixed; background-color: #fff;
      border-right: 1px solid #ddd; padding: 20px 0; border-top-right-radius: 15px;
      border-bottom-right-radius: 15px; box-shadow: 2px 0 8px rgba(0, 0, 0, 0.05);
    }
    .sidebar h5, .sidebar p { text-align: center; }
    .sidebar a {
      display: block; padding: 12px 20px; color: #333; text-decoration: none;
      border-radius: 10px; margin: 6px 12px; transition: 0.3s;
    }
    .sidebar a.active, .sidebar a:hover { background-color: #007bff; color: white; }
    .main {
      margin-left: 260px; padding: 30px 40px; background-color: #f9fbff;
      border-top-left-radius: 15px; border-bottom-left-radius: 15px; min-height: 100vh;
    }
    .form-label { font-weight: 600; }
    .section { display: none; }
    .section.active {
      display: block; background-color: white; padding: 25px;
      border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    .toast {
      position: fixed; bottom: 20px; right: -300px; min-width: 250px;
      background-color: #333; color: white; padding: 12px 24px;
      border-radius: 6px; box-shadow: 0 0 10px rgba(0,0,0,0.3);
      animation: slideIn 0.5s forwards; z-index: 1000;
    }
    @keyframes slideIn {
      from { right: -300px; } to { right: 20px; }
    }
    .user-table { font-size: 14px; }
  </style>
</head>
<body>

<div class="sidebar">
  <h5 class="text-primary">User Manager</h5>
  <p class="text-muted">Sagar</p>
  <a href="#" onclick="showSection('add', event)">‚ûï Add User</a>
  <a href="#" onclick="showSection('delete', event)">‚ùå Delete User</a>
  <a href="#" onclick="showSection('pause', event)">‚è∏Ô∏è Pause User</a>
  <a href="#" onclick="showSection('info', event)">‚ÑπÔ∏è Info User</a>
  <a href="#" onclick="showSection('show', event)">üìã Show Users</a>
  <a href="#" onclick="showSection('reset', event)">üîÑ Reset HWID</a>
</div>

<div class="main">
  <div class="mb-4">
    <label for="appSelect" class="form-label">Select Application</label>
    <select class="form-select" id="appSelect" onchange="refreshUsers()">
      <option value="SAGAR">SAGAR</option>
      <option value="ADMIN">ADMIN</option>
      <option value="TESTER">TESTER</option>
    </select>
  </div>

  <!-- Add User -->
  <div id="add" class="section active">
    <h4>‚ûï Add User</h4>
    <form onsubmit="addUser(event)">
      <div class="mb-2"><input required type="text" class="form-control" placeholder="Username" id="add_username"></div>
      <div class="mb-2"><input required type="password" class="form-control" placeholder="Password" id="add_password"></div>
      <div class="mb-2"><input required type="date" class="form-control" id="add_expiry"></div>
      <button class="btn btn-success">Add</button>
    </form>
  </div>

  <!-- Delete User -->
  <div id="delete" class="section">
    <h4>‚ùå Delete User</h4>
    <form onsubmit="deleteUser(event)">
      <div class="mb-2"><input required type="text" class="form-control" placeholder="Username" id="delete_username"></div>
      <button class="btn btn-danger">Delete</button>
    </form>
  </div>

  <!-- Pause User -->
  <div id="pause" class="section">
    <h4>‚è∏Ô∏è Pause / Unpause User</h4>
    <form onsubmit="pauseUser(event, 'pause')">
      <div class="mb-2"><input required type="text" class="form-control" placeholder="Username" id="pause_username"></div>
      <button class="btn btn-warning me-2">Pause</button>
      <button type="button" class="btn btn-secondary" onclick="pauseUser(event, 'unpause')">Unpause</button>
    </form>
  </div>

  <!-- Info User -->
  <div id="info" class="section">
    <h4>‚ÑπÔ∏è User Info</h4>
    <form onsubmit="infoUser(event)">
      <div class="mb-2"><input required type="text" class="form-control" placeholder="Username" id="info_username"></div>
      <button class="btn btn-primary">Get Info</button>
    </form>
    <div id="infoPanel" class="mt-3"></div>
  </div>

  <!-- Show Users -->
  <div id="show" class="section">
    <h4>üìã All Users</h4>
    <table class="table table-bordered user-table">
      <thead class="table-light">
        <tr>
          <th>Username</th>
          <th>Password</th>
          <th>HWID</th>
          <th>Expiry</th>
          <th>Created</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="userList"></tbody>
    </table>
  </div>

  <!-- Reset HWID -->
  <div id="reset" class="section">
    <h4>üîÑ Reset HWID</h4>
    <form onsubmit="resetHWID(event)">
      <div class="mb-2">
        <input required type="text" class="form-control" placeholder="Username" id="reset_username">
      </div>
      <button class="btn btn-dark">Reset HWID</button>
    </form>
  </div>
</div>

<div id="toast" class="toast" style="display:none;"></div>

<script>
function showToast(msg) {
  const toast = document.getElementById("toast");
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), 3000);
}

function getCategory() {
  const app = document.getElementById('appSelect').value;
  if (!app || app === "Select App") {
    showToast("‚ùó Select an app");
    return null;
  }
  return app;
}

function createApp() {
  const name = document.getElementById('appName').value.trim();
  if (!name) return showToast('‚ùó Enter application name');
  fetch('/create_app', {
    method: 'POST',
    body: new URLSearchParams({ app_name: name })
  }).then(res => res.json()).then(d => {
    showToast(d.message);
    if (d.status === 'success') {
      const select = document.getElementById('appSelect');
      const option = document.createElement('option');
      option.value = name;
      option.text = name;
      select.add(option);
    }
  });
}

function createUser() {
  const category = getCategory(); if (!category) return;
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  const expiry = document.getElementById('expiry').value;
  if (!username || !password || !expiry) return showToast("‚ùó Fill all fields");

  fetch('/add_user', {
    method: 'POST',
    body: new URLSearchParams({ category, username, password, expiry })
  }).then(res => res.json()).then(d => {
    showToast(d.message);
  });
}

function removeUser() {
  const category = getCategory(); if (!category) return;
  const user = document.getElementById('removeUsername').value.trim();
  fetch('/delete_user', {
    method: 'POST',
    body: new URLSearchParams({ category, username: user })
  }).then(res => res.json()).then(d => {
    showToast(d.message);
  });
}

function pauseUser() {
  const category = getCategory(); if (!category) return;
  const user = document.getElementById('suspendUsername').value.trim();
  fetch('/pause_user', {
    method: 'POST',
    body: new URLSearchParams({ category, username: user, action: 'pause' })
  }).then(res => res.json()).then(d => showToast(d.message));
}

function unpauseUser() {
  const category = getCategory(); if (!category) return;
  const user = document.getElementById('suspendUsername').value.trim();
  fetch('/pause_user', {
    method: 'POST',
    body: new URLSearchParams({ category, username: user, action: 'unpause' })
  }).then(res => res.json()).then(d => showToast(d.message));
}

function resetHWID() {
  const category = getCategory(); if (!category) return;
  const user = document.getElementById('resetUsername').value.trim();
  fetch('/reset_hwid', {
    method: 'POST',
    body: new URLSearchParams({ category, username: user })
  }).then(res => res.json()).then(d => showToast(d.message));
}

function showUserInfo() {
  const category = getCategory(); if (!category) return;
  const username = document.getElementById('searchUser').value.trim();
  fetch('/info_user', {
    method: 'POST',
    body: new URLSearchParams({ category, username })
  }).then(res => res.json()).then(d => {
    const box = document.getElementById('userInfoOutput');
    if (d.status !== 'success') return box.textContent = d.message;
    const u = d.data;
    box.textContent = `üë§ Username: ${u.Username}
üîê Password: ${u.Password}
üñ•Ô∏è HWID: ${u.HWID || 'None'}
üìõ Status: ${u.Status}
üìÖ Expiry: ${u.Expiry}
üïí Created At: ${u.CreatedAt}`;
  });
}

function loadUsersTable() {
  const category = getCategory(); if (!category) return;
  fetch('/get_users', {
    method: 'POST',
    body: new URLSearchParams({ category })
  }).then(res => res.json()).then(users => {
    const tbody = document.querySelector("#usersTable tbody");
    tbody.innerHTML = "";
    users.forEach(u => {
      tbody.innerHTML += `<tr>
        <td>${u.Username}</td>
        <td>${u.Password}</td>
        <td>${u.HWID || 'None'}</td>
        <td>${u.Status}</td>
        <td>${u.Expiry}</td>
        <td>${u.CreatedAt}</td>
      </tr>`;
    });
  });
}

function sendMessage() {
  const category = getCategory(); if (!category) return;
  const username = document.getElementById('messageUser').value.trim();
  const message = document.getElementById('messageText').value.trim();
  if (!username || !message) return showToast("‚ùó Fill username & message");

  fetch('/send_message', {
    method: 'POST',
    body: new URLSearchParams({ category, username, message })
  }).then(res => res.json()).then(d => {
    showToast(d.message);
    if (d.status === 'success') {
      document.getElementById('messageText').value = "";
    }
  });
}
</script>

</body>
</html>

